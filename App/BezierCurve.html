<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BÃ©zier Curve</title>
    <style>
        canvas {
            background-color: #f0f0f0;
        }

        .point {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: white;
            position: absolute;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <canvas id="BezierCanvas" width="1000" height="800"></canvas>
    <script>

        // Init Canvas Setup
        const canvas = document.getElementById('BezierCanvas');
        const ctx = canvas.getContext('2d');

        let draggingPoint = {};

        // Points Definition
        const T = 0.5;
        const POINTS_DEF = {
            size: 4,
            width: 10,
            height: 10
        }

        // Bezier Curve Line Definition
        const LINE_DEF = {
            color: 'black',
            width: 2,
        }

        const POINTS = [
            { x: 500, y: 150 },
            { x: 800, y: 400 },
            { x: 200, y: 400 },
            { x: 500, y: 650 }
        ];

        function drawBezierCurve() {
            const curvePoints = [];
            for (let t = 0; t <= 1; t += 0.01) {
                let p = getBezierPoint(POINTS, t);
                curvePoints.push(p);
            }

            // Start to draw Bezier Curve line.
            ctx.beginPath();
            curvePoints.forEach((point, index) => {
                if (index === 0) {
                    ctx.moveTo(point.x, point.y);
                } else {
                    ctx.lineTo(point.x, point.y);
                }

                ctx.strokeStyle = 'black';
                ctx.lineWidth = LINE_DEF.width;
                ctx.stroke();
            });
        }

        function getBezierPoint(points, t) {
            const n = points.length;

            // Return first point if size is 1
            if (n === 1) {
                return points[0];
            }

            // To cal Bezier Points
            const newPoints = [];
            for (let i = 0; i < n - 1; i++) {
                const p0 = points[i];
                const p1 = points[i + 1];
                newPoints.push({
                    x: p0.x + (p1.x - p0.x) * t,
                    y: p0.y + (p1.y - p0.y) * t
                });
            }

            return getBezierPoint(newPoints, t);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // To draw Bezier Curve
            drawBezierCurve();

            // Drawing the default points & lines
            ctx.beginPath();
            POINTS.forEach((point, index) => {
                console.log(`drawPoint: ${JSON.stringify(point)}`)
                drawPoint(point);
            });
        }

        function drawLine(point, index) {
            if (index === 0) {
                ctx.moveTo(point.x, point.y);
            } else {
                ctx.lineTo(point.x, point.y);
            }

            ctx.strokeStyle = 'black';
            ctx.lineWidth = LINE_DEF.width;
            ctx.stroke();
        }

        function drawPoint(point) {
            ctx.beginPath();
            ctx.strokeStyle = 'black';
            ctx.fillStyle = 'white';
            ctx.lineWidth = 1;

            // To center the rectangle at (point.x, point.y), offset by half the rectangle's width and height.
            const x = point.x - (POINTS_DEF.width / 2);
            const y = point.y - (POINTS_DEF.height / 2);
            ctx.rect(x, y, POINTS_DEF.width, POINTS_DEF.height);

            ctx.fill();
            ctx.stroke();
        }

        window.onload = draw;

        // --------------------------------------------------------------------------------------------
        // Controller 

        function onMouseMove(event) {
            if (draggingPoint) {
                const rect = canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;

                draggingPoint.x = x;
                draggingPoint.y = y;

                draw();
            }
        }

        function onMouseDown(event) {
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            draggingPoint = POINTS.find(p => Math.sqrt((p.x - x) ** 2 + (p.y - y) ** 2) < POINTS_DEF.height);
        }

        function onMouseUp() {
            draggingPoint = {};
        }

        canvas.addEventListener('mousemove', onMouseMove);
        canvas.addEventListener('mousedown', onMouseDown);
        canvas.addEventListener('mouseup', onMouseUp);

    </script>
</body>

</html>